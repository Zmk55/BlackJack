<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackJack - SSH Client</title>
    <link rel="stylesheet" href="styles.css">
    <!-- xterm.js for terminal emulation -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>
</head>
<body>
    <div id="app">
        <!-- Tab Bar -->
        <div class="tab-bar">
            <div class="tabs">
                <div class="tab active" data-tab="main">
                    <span class="tab-title">BlackJack</span>
                </div>
                <button class="new-tab-btn" onclick="createNewTab()">+</button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="content-area">
            <!-- Main Tab Content -->
            <div id="main-tab" class="tab-content active">
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <div class="sidebar-title">
                            <h3>Organization</h3>
                            <button class="btn btn-collapse" onclick="toggleSidebar()" title="Collapse Sidebar">◀</button>
                        </div>
                        <div class="sidebar-actions">
                            <button class="btn btn-primary" onclick="showAddGroup()">+ Group</button>
                            <button class="btn btn-primary" onclick="showAddHost()">+ Host</button>
                        </div>
                    </div>
                    <div class="sidebar-content">
                        <div class="tree-view" id="tree-view">
                            <!-- Groups and hosts will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="toolbar">
                        <div class="toolbar-left">
                            <button class="btn btn-primary" onclick="showAllHosts()" id="view-all-btn">View All Hosts</button>
                            <span class="filter-info" id="filter-info">Showing all hosts</span>
                        </div>
                        <div class="toolbar-center">
                            <div class="search-container">
                                <input type="text" id="search-input" placeholder="Search hosts, groups, or tags..." class="search-input">
                                <button class="btn btn-secondary" onclick="clearSearch()" id="clear-search-btn" style="display: none;">Clear</button>
                            </div>
                        </div>
                        <div class="toolbar-right">
                            <button class="btn" onclick="showSettings()">Settings</button>
                            <button class="btn" onclick="exportHosts()">Export</button>
                            <button class="btn" onclick="importHosts()">Import</button>
                        </div>
                    </div>
                    
                    <div class="host-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Address</th>
                                    <th>User</th>
                                    <th>Port</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="host-table-body">
                                <!-- Host data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="add-host-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Host</h3>
                <button class="close" onclick="closeModal('add-host-modal')">×</button>
            </div>
            <div class="modal-body">
                <form id="add-host-form">
                    <div class="form-content">
                        <div class="form-group">
                            <label for="host-name">Name:</label>
                            <input type="text" id="host-name" required>
                        </div>
                        <div class="form-group">
                            <label for="host-address">Address:</label>
                            <input type="text" id="host-address" required>
                        </div>
                        <div class="form-group">
                            <label for="host-user">User:</label>
                            <input type="text" id="host-user" required>
                        </div>
                        <div class="form-group">
                            <label for="host-port">Port:</label>
                            <input type="number" id="host-port" value="22">
                        </div>
                        <div class="form-group" id="tailscale-ip-group" style="display: none;">
                            <label for="host-tailscale-ip">Tailscale IP:</label>
                            <input type="text" id="host-tailscale-ip" placeholder="100.x.x.x">
                            <small class="form-help">Enter the Tailscale IP address for this host</small>
                        </div>
                        <div class="form-group">
                            <label for="host-group">Group:</label>
                            <select id="host-group">
                                <option value="">No Group</option>
                            </select>
                        </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="host-tags">Tags:</label>
                        <div class="tag-management">
                            <div class="tag-input-row">
                                <div class="tag-input-container">
                                    <input type="text" id="tag-name-input" placeholder="Enter tag name" autocomplete="off">
                                    <div class="tag-dropdown" id="tag-dropdown">
                                        <!-- Tag history will be populated here -->
                                    </div>
                                </div>
                                <div class="color-palette">
                                    <button type="button" class="color-btn tag-red selected" data-color="red" title="Red"></button>
                                    <button type="button" class="color-btn tag-blue" data-color="blue" title="Blue"></button>
                                    <button type="button" class="color-btn tag-green" data-color="green" title="Green"></button>
                                    <button type="button" class="color-btn tag-yellow" data-color="yellow" title="Yellow"></button>
                                    <button type="button" class="color-btn tag-purple" data-color="purple" title="Purple"></button>
                                    <button type="button" class="color-btn tag-orange" data-color="orange" title="Orange"></button>
                                    <button type="button" class="color-btn tag-pink" data-color="pink" title="Pink"></button>
                                    <button type="button" class="color-btn tag-cyan" data-color="cyan" title="Cyan"></button>
                                    <button type="button" class="color-btn tag-gray" data-color="gray" title="Gray"></button>
                                </div>
                                <button type="button" class="btn btn-primary" id="add-tag-btn">+</button>
                            </div>
                            <div class="tag-list" id="tag-list">
                                <!-- Tags will be added here -->
                            </div>
                        </div>
                    </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('add-host-modal')">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="host-submit-btn">Add Host</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="connection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connect to Host</h3>
                <button class="close" onclick="closeModal('connection-modal')">×</button>
            </div>
            <div class="modal-body">
                <div class="connection-options">
                    <button class="btn btn-primary" onclick="connectSSH()">SSH Shell</button>
                    <button class="btn btn-primary" onclick="connectSSHCommand()">SSH Command</button>
                    <button class="btn btn-primary" onclick="createSSHTab()">New SSH Tab</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Group Modal -->
    <div id="add-group-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Group</h3>
                <button class="close" onclick="closeModal('add-group-modal')">×</button>
            </div>
            <div class="modal-body">
                <form id="add-group-form">
                    <div class="form-group">
                        <label for="group-name">Group Name:</label>
                        <input type="text" id="group-name" required>
                    </div>
                    <div class="form-group">
                        <label for="parent-group">Parent Group:</label>
                        <select id="parent-group">
                            <option value="">None (Root Group)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="group-description">Description:</label>
                        <textarea id="group-description" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('add-group-modal')">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="group-submit-btn">Add Group</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="close" onclick="closeModal('settings-modal')">×</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>Application</h4>
                    <div class="setting-item">
                        <label>Theme</label>
                        <select>
                            <option>Dark</option>
                            <option>Light</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Auto-save</label>
                        <input type="checkbox" checked>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Security</h4>
                    <div class="setting-item">
                        <label>Session timeout (minutes)</label>
                        <input type="number" value="30">
                    </div>
                    <div class="setting-item">
                        <label>Require password for connections</label>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Data Management</h4>
                    <div class="setting-item">
                        <label>Clear Tag History</label>
                        <button class="btn btn-danger" onclick="clearTagHistory()">Clear All Tags</button>
                        <small class="form-help">This will remove all tag history and reset the tag suggestions</small>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Integrations</h4>
                    <div class="setting-item">
                        <button class="btn btn-primary" onclick="showIntegrations()">Manage Integrations</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('settings-modal')">Cancel</button>
                <button class="btn btn-primary">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Integrations Modal -->
    <div id="integrations-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Integrations</h3>
                <button class="close" onclick="closeModal('integrations-modal')">×</button>
            </div>
            <div class="modal-body">
                <div class="integration-item">
                    <div class="integration-header">
                        <div class="integration-info">
                            <h4>Tailscale</h4>
                            <p>Connect to your Tailscale network devices</p>
                        </div>
                        <div class="integration-status">
                            <span class="status-badge" id="tailscale-status">Disabled</span>
                        </div>
                    </div>
                    <div class="integration-controls">
                        <button class="btn btn-secondary" id="tailscale-disable-btn" onclick="toggleTailscale(false)" disabled>Disable</button>
                        <button class="btn btn-primary" id="tailscale-enable-btn" onclick="toggleTailscale(true)">Enable</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('integrations-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveIntegrations()">Save</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
